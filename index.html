<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>سهم Libyanote — Ticker</title>
  <style>
    body{font-family: Tahoma, Arial, sans-serif; background:#f8f9fb; display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .ticker{background:#fff;border-radius:10px;padding:14px 18px;box-shadow:0 6px 18px rgba(20,30,50,0.08);display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#0ea5a4,#7c3aed);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .meta{display:flex;flex-direction:column}
    .name{font-size:16px;font-weight:700}
    .price{font-size:20px;font-weight:800}
    .change{font-size:13px}
    .small{font-size:12px;color:#666}
  </style>
</head>
<body>
  <div class="ticker" id="ticker">
    <div class="logo">N</div>
    <div class="meta">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="name">Libyanote <span class="small">(NLY)</span></div>
        <div id="status" class="small">جاري الاتصال…</div>
      </div>
      <div style="display:flex;gap:12px;align-items:baseline">
        <div class="price" id="price">--- USD</div>
        <div class="change" id="change">—</div>
      </div>
    </div>
  </div>

<script>
// الإعدادات
const POLL_INTERVAL_MS = 5000; // كل 5 ثواني
const CHAIN_ID = 'bsc'; // غيّر إلى السلسلة المناسبة (مثال: 'ethereum' أو 'bsc')
const CONTRACT = '0x1eE4a6e9ee95a93243A37492e82d5bD1690f2588'.toLowerCase();

// عناصر الصفحة
const priceEl = document.getElementById('price');
const changeEl = document.getElementById('change');
const statusEl = document.getElementById('status');

let lastPrice = null;

async function fetchDexScreenerPrice() {
  // نستخدم endpoint /token-pairs/v1 أو /tokens/v1 حسب الوثائق
  // نطلب جميع أزواج تحتوي على هذا الرمز
  const url = `https://api.dexscreener.com/token-pairs/v1/${CHAIN_ID}/${CONTRACT}`;
  // أو ربما: https://api.dexscreener.com/tokens/v1/${CHAIN_ID}/${CONTRACT}
  // جرب أي منهما إذا لم ينجح
  const res = await fetch(url);
  if (!res.ok) {
    throw new Error('DexScreener HTTP error');
  }
  const data = await res.json();
  // التحقق إن البيانات صحيحة
  if (!data || !data.pairs || data.pairs.length === 0) {
    throw new Error('No pairs found');
  }
  // نأخذ الزوج الأول على الأقل
  const pair = data.pairs[0];
  const priceUsd = parseFloat(pair.priceUsd);
  const priceChange = parseFloat(pair.priceChange?.usd ?? pair.priceChange);
  return { price: priceUsd, change24h: priceChange };
}

function formatUsd(v) {
  if (v === null || v === undefined || isNaN(v)) return '--- USD';
  if (v >= 1) return '$' + Number(v).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
  return '$' + Number(v).toFixed(6);
}

function formatChange(v) {
  if (v === null || v === undefined || isNaN(v)) return '—';
  const sign = v >= 0 ? '+' : '';
  return `${sign}${v.toFixed(2)}% (24h)`;
}

async function update() {
  statusEl.textContent = 'جاري التحديث...';
  try {
    const { price, change24h } = await fetchDexScreenerPrice();
    priceEl.textContent = formatUsd(price);
    changeEl.textContent = formatChange(change24h);
    statusEl.textContent = 'مباشر';

    // تغيير اللون حسب الاتجاه
    if (lastPrice !== null) {
      if (price > lastPrice) {
        priceEl.style.color = 'green';
      } else if (price < lastPrice) {
        priceEl.style.color = 'red';
      } else {
        priceEl.style.color = '';
      }
    }
    lastPrice = price;
  } catch (e) {
    console.warn('Error fetching price:', e);
    statusEl.textContent = 'خطأ في الاتصال';
    priceEl.textContent = '--- USD';
    changeEl.textContent = '—';
  }
}

// تشغيل أول مرة ثم تكرار
update();
setInterval(update, POLL_INTERVAL_MS);
</script>
</body>
</html>
