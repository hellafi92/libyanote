<!-- libyanote-ticker.html

وصف:
ملف HTML جاهز لوضعه على GitHub Pages (github.io) ليعرض سعر عملة "Libyanote" كنص يتحدّث مباشرة (polling).

كيفية الاستخدام السريع:
1. ضع هذا الملف في مستودع GitHub Pages (مثلاً في الفرع main ل repo username.github.io).
2. افتح الملف عبر https://<username>.github.io/libyanote-ticker.html
3. **تعديل مصدر السعر:**
   - إن كانت العملة متاحة على CoinGecko، ضع قيمة `COINGECKO_ID` (مثل 'bitcoin') وسيجلب الملف السعر من CoinGecko.
   - إن كان لديك API خاص يرجع JSON مثل { "price_usd": 0.12 }, غيّر `fetchPriceFromCustomApi()` لتتوافق مع ال JSON الخاص بك.

التحديث الافتراضي: كل 5 ثواني (قابل للتعديل في المتغير `POLL_INTERVAL_MS`).

-->

<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>سهم Libyanote — Ticker</title>
  <style>
    body{font-family: Tahoma, Arial, sans-serif; background:#f8f9fb; display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .ticker{background:#fff;border-radius:10px;padding:14px 18px;box-shadow:0 6px 18px rgba(20,30,50,0.08);display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#0ea5a4,#7c3aed);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .meta{display:flex;flex-direction:column}
    .name{font-size:16px;font-weight:700}
    .price{font-size:20px;font-weight:800}
    .change{font-size:13px}
    .small{font-size:12px;color:#666}
  </style>
</head>
<body>
  <div class="ticker" id="ticker">
    <div class="logo">N</div>
    <div class="meta">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="name">Libyanote <span class="small">(NLY)</span></div>
        <div id="status" class="small">جاري الاتصال…</div>
      </div>
      <div style="display:flex;gap:12px;align-items:baseline">
        <div class="price" id="price">--- USD</div>
        <div class="change" id="change">—</div>
      </div>
    </div>
  </div>

<script>
// إعدادات
const POLL_INTERVAL_MS = 5000; // كل 5 ثواني
const USE_COINGECKO = true; // اذا كانت العملة مسجلة على CoinGecko ضع true
const COINGECKO_ID = 'libyanote'; // غيّر هذا إلى معرف العملة في CoinGecko اذا وجد

// بديل: عنوان API خاص يرجع JSON مع سعر بالدولار
const CUSTOM_API_URL = 'https://example.com/api/libyanote/price'; // غيره إلى API الخاص بك

// عناصر الصفحة
const priceEl = document.getElementById('price');
const changeEl = document.getElementById('change');
const statusEl = document.getElementById('status');

let lastPrice = null;

async function fetchPriceFromCoinGecko() {
  try {
    const url = `https://api.coingecko.com/api/v3/simple/price?ids=${encodeURIComponent(COINGECKO_ID)}&vs_currencies=usd&include_24hr_change=true`;
    const res = await fetch(url);
    if (!res.ok) throw new Error('CoinGecko response not OK');
    const data = await res.json();
    if (!data[COINGECKO_ID] || !data[COINGECKO_ID].usd) throw new Error('CoinGecko: data not found for id');
    return { price: data[COINGECKO_ID].usd, change24h: data[COINGECKO_ID].usd_24h_change };
  } catch (e) {
    console.warn('CoinGecko fetch failed:', e);
    throw e;
  }
}

async function fetchPriceFromCustomApi() {
  // عدّل هذا الجزء ليتوافق مع صيغة JSON ل API عندك
  try {
    const res = await fetch(CUSTOM_API_URL);
    if (!res.ok) throw new Error('Custom API not OK');
    const data = await res.json();
    // مثال متوقع: { "price_usd": 0.12, "change_24h": 1.5 }
    return { price: Number(data.price_usd), change24h: Number(data.change_24h) };
  } catch (e) {
    console.warn('Custom API fetch failed:', e);
    throw e;
  }
}

function formatUsd(v){
  if (v === null || v === undefined || isNaN(v)) return '--- USD';
  if (v >= 1) return '$' + Number(v).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
  return '$' + Number(v).toFixed(6); // عملات صغيرة
}

function formatChange(v){
  if (v === null || v === undefined || isNaN(v)) return '—';
  const sign = v >= 0 ? '+' : '';
  return `${sign}${Number(v).toFixed(2)}% (24h)`;
}

async function update() {
  statusEl.textContent = 'جاري التحديث...';
  try {
    let res;
    if (USE_COINGECKO) {
      res = await fetchPriceFromCoinGecko();
    } else {
      res = await fetchPriceFromCustomApi();
    }
    const { price, change24h } = res;
    priceEl.textContent = formatUsd(price) + ' USD';
    changeEl.textContent = formatChange(change24h);
    statusEl.textContent = 'مباشر';

    // تلوين مؤقت للزيادة/النقصان
    if (lastPrice !== null) {
      if (price > lastPrice) {
        priceEl.style.color = 'green';
      } else if (price < lastPrice) {
        priceEl.style.color = 'red';
      } else {
        priceEl.style.color = '';
      }
    }
    lastPrice = price;
  } catch (e) {
    statusEl.textContent = 'خطأ في الاتصال';
    priceEl.textContent = '--- USD';
    changeEl.textContent = '—';
  }
}

// تشغيل أول مرة ثم تكرار
update();
setInterval(update, POLL_INTERVAL_MS);
</script>
</body>
</html>
